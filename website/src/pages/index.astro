---
import Layout from "../layouts/Layout.astro";
import { fetchSnapshot } from "../util/Data";
import { formatHost, formatCount, formatDate } from "../util/Format";

const snapshot = await fetchSnapshot();
---

<Layout>
  <div class="link-group">
    {
      snapshot.links.map((link) => (
        <div class="link">
          <a
            href={`https://redirect.theblue.report?url=${encodeURIComponent(link.url)}`}
            class="preview redirect-link"
            data-original-url={link.url}
          >
            {link.thumbnail_id ? (
              <img
                src={`https://assets.theblue.report/thumbnails/${link.thumbnail_id}.jpg`}
              />
            ) : (
              <div class="placeholder">ðŸ”—</div>
            )}
          </a>
          <div class="content">
            <p class="title">
              <a
                href={`https://redirect.theblue.report?url=${encodeURIComponent(link.url)}`}
                class="redirect-link"
                data-original-url={link.url}
              >
                {link.rank}. {link.title}
              </a>
            </p>
            <p class="metadata">
              <span class="host">{formatHost(link.url)}</span>
              <span class="bullet">â€¢</span>
              <span>
                {formatCount(link.post_count)} posts,{" "}
                {formatCount(link.repost_count)} reposts,{" "}
                {formatCount(link.like_count)} likes
              </span>
              <span class="bullet">â€¢</span>
              <span>{formatCount(link.click_count)} blue report clicks</span>
            </p>
          </div>
        </div>
      ))
    }
  </div>
  <p class="last-updated">Last updated {formatDate(snapshot.generated_at)}</p>
</Layout>
